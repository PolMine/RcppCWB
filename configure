#!/bin/bash

PLATFORM=$(uname -s)

if [ "$PLATFORM" = "Darwin" ]; then
  CWB_DISTRO="cwb-3.0.0-osx-10.5-universal"
elif [ "$PLATFORM" = "Linux" ]; then
  ARCH=`lscpu | head -n 1 | grep -oP '\d+$'`
  if [ "$ARCH" = "64" ]; then
    CWB_DISTRO="cwb-3.0.0-linux-x86_64"
  else 
    CWB_DISTRO="cwb-3.0.0-linux-i386"
  fi
elif [ "$PLATFORM" = "SunOS" ]; then
  CWB_DISTRO="cwb-3.0.0-solaris-sparc"
fi

CWB_TARBALL=$CWB_DISTRO.tar.gz
CWB_URL=https://sourceforge.net/projects/cwb/files/cwb/cwb-3.0.0/$CWB_TARBALL
R_CMD='download.file(url = "'"$CWB_URL"'", destfile = "'"$CWB_TARBALL"'")'

if [ ! -e /usr/local/lib/libcl.a ]; then
  Rscript -e "$R_CMD"
  tar xzfv $CWB_TARBALL
  rm $CWB_TARBALL
  mv $CWB_DISTRO cwb
else
  if [ ! -e ./cwb ]; then
    mkdir cwb
    mkdir cwb/lib
  fi
fi 



REGISTRY_FILE=$(pwd)/inst/extdata/cwb/registry/reuters
HOME_LINE="HOME $R_PACKAGE_DIR/extdata/cwb/indexed_corpora/reuters"

R_CMD='r<-readLines("'"$REGISTRY_FILE"'");r[10]<-"'"$HOME_LINE"'";writeLines(text=r,con="'"$REGISTRY_FILE"'")'
Rscript -e "$R_CMD"
