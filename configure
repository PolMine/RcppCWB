#!/bin/bash

case $(uname -s) in
  Darwin)
    PKG_CPPFLAGS="/Users/blaette/Lab/github/RcppCWB/src/cwb/cl"
    PKG_LIBS="/Users/blaette/Lab/github/RcppCWB/src/cwb/cl";;
  Linux)
    ARCH=`lscpu | head -n 1 | grep -oP '\w+$'`
    case "$ARCH" in 
      x86_64)
        FOO="";;
      i386) 
        FOO="";;
      arm)
        echo "Did not find an installation of the Corpus Workbench (CWB) on your system."
        exit 1;
    esac;;
  SunOS)
    CPU_INFO=`psrinfo -pv | sed -n '2p'`
    case $CPU_INFO in
      x86)
        echo "Did not find an installation of the Corpus Workbench (CWB) on your system."
        exit;;
      SPARK)
        FOO="";;
    esac;;
esac
  

# Augment Makevars
echo $(R_PACKAGE_SOURCE)
echo "cl: depend" >> ./src/Makevars
echo -e '\tR_PACKAGE_SOURCE="$(R_PACKAGE_SOURCE)" $(MAKE) -C cwb cl\n' >> ./src/Makevars
echo "depend: clean" >> ./src/Makevars
echo -e '\tR_PACKAGE_SOURCE="$(R_PACKAGE_SOURCE)" $(MAKE) -C cwb depend\n' >> ./src/Makevars
echo "clean:" >> ./src/Makevars
echo -e '\tR_PACKAGE_SOURCE="$(R_PACKAGE_SOURCE)" $(MAKE) -C cwb clean\n' >> ./src/Makevars

cat ./src/Makevars

# Call the setpaths.R script to set paths
# this is a standardized script that is part of the ctk package 

${R_HOME}/bin/Rscript ./tools/setpaths.R --args "$R_PACKAGE_DIR"

