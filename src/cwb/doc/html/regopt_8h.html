<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>CWB: cl/regopt.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CWB
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0b9712b4d566c131b10613af70a8e558.html">cl</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">regopt.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="globals_8h.html">globals.h</a>&quot;</code><br />
<code>#include &lt;pcre.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct___c_l___regex.html">_CL_Regex</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Underlying structure for CL_Regex object.  <a href="struct___c_l___regex.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aafa5fbfbe826a5bf208d173bf0609747"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="regopt_8h.html#aafa5fbfbe826a5bf208d173bf0609747">MAX_GRAINS</a>&#160;&#160;&#160;12</td></tr>
<tr class="memdesc:aafa5fbfbe826a5bf208d173bf0609747"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum number of grains of optimisation.  <a href="#aafa5fbfbe826a5bf208d173bf0609747">More...</a><br /></td></tr>
<tr class="separator:aafa5fbfbe826a5bf208d173bf0609747"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a697918b2f55aa6a0fd29906a934f5836"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="regopt_8h.html#a697918b2f55aa6a0fd29906a934f5836">regopt_data_copy_to_regex_object</a> (<a class="el" href="cl_8h.html#ab595272450836292a293ea13eb49ef0b">CL_Regex</a> rx)</td></tr>
<tr class="memdesc:a697918b2f55aa6a0fd29906a934f5836"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy grain set from internal global variables to CL_Regex object &ndash; part of the CL Regex Optimiser.  <a href="#a697918b2f55aa6a0fd29906a934f5836">More...</a><br /></td></tr>
<tr class="separator:a697918b2f55aa6a0fd29906a934f5836"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab312a681f0a8c861a08f9d26a3f4ab95"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="regopt_8h.html#ab312a681f0a8c861a08f9d26a3f4ab95">cl_regopt_analyse</a> (char *regex)</td></tr>
<tr class="memdesc:ab312a681f0a8c861a08f9d26a3f4ab95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Analyses a regular expression and tries to find the best set of grains.  <a href="#ab312a681f0a8c861a08f9d26a3f4ab95">More...</a><br /></td></tr>
<tr class="separator:ab312a681f0a8c861a08f9d26a3f4ab95"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="aafa5fbfbe826a5bf208d173bf0609747"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_GRAINS&#160;&#160;&#160;12</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximum number of grains of optimisation. </p>
<p>There's no point in scanning for too many grains, but some regexps used to be bloody inefficient. </p>

<p>Referenced by <a class="el" href="regopt_8c.html#ae7f8befdb6db56e9d197e57131df7743">read_disjunction()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ab312a681f0a8c861a08f9d26a3f4ab95"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_regopt_analyse </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>regex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Analyses a regular expression and tries to find the best set of grains. </p>
<p>Part of the regex optimiser. For a given regular expression, this function will try to extract a set of grains from regular expression {regex_string}. These grains are then used by the CL regex matcher and <a class="el" href="cdaccess_8c.html#a6eb4641e0a1e14b63f2d5f2f5b6a8cea" title="Gets a list of the ids of those items on a given Attribute that match a particular regular-expression...">cl_regex2id()</a> as a pre-filter for faster regular expression search.</p>
<p>The function only recognizes relatively simple regular expressions without recursive nesting, which roughly correspond to wildcard searches similar to SQL's LIKE operator. Searching for a fixed prefix, suffix or infix (or a small set of alternatives) will see the most noticeable performance improvement. Any more complex expression is passed directly to the standard PCRE evaluation. See <a class="el" href="regopt_8c.html#a2c4607eb8e094b7699062df8eb744058" title="Create a new CL_regex object (ie a regular expression buffer). ">cl_new_regex()</a> for an overview of the supported subsets of PCRE syntax.</p>
<p>If successful, this function returns True and stores the grains in the optiomiser's global variables above, from which they then must be copied to a CL_Regex object with <a class="el" href="regopt_8c.html#a697918b2f55aa6a0fd29906a934f5836" title="Copy grain set from internal global variables to CL_Regex object â€“ part of the CL Regex Optimiser...">regopt_data_copy_to_regex_object()</a>. This step will also casefold grains if necessary and prepare the Boyer-Moore jump tables.</p>
<p>Usage: optimised = cl_regopt_analyse(regex_string);</p>
<p>This is a non-exported function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">regex</td><td>String containing the regex to optimise. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Boolean: true = ok, false = couldn't optimise regex. </dd></dl>
<p>The code below parses a regular expression using the supported PCRE subset and attempts to extract a literal string ("grain") that must occur in every match of the regular expression. In a disjunction group, each alternative must contain a grain in order to be used for optimized matching; we refer to this as a complete grain set.</p>
<p>The algorithm scans the regular expression from left to right, looking for the following supported elements in the specified order:</p>
<ol type="1">
<li>a literal grain (read_grain)</li>
<li>a parenthesized disjunction containing grains (read_disjunction)</li>
<li>a segment matching some, possibly empty substring (read_wildcard), including recursively nested capturing or non-capturing groups</li>
</ol>
<p>See the respective functions for further information on these elements. Grains are collected by read_grain and read_disjunction in a local buffer. If a complete grain set has been found, it replaces the previous global grain set if it is considered to be more effective based on the length and number of grains.</p>
<p>As a special case, the optimizer first attempts to match the entire regexp as a simple disjunction (read_disjunction) without parentheses.</p>

<p>References <a class="el" href="globals_8c.html#a5c4290325b240eac5fe1542a8743286a">cl_debug</a>, <a class="el" href="regopt_8c.html#aeea8fcadfd245bf518d90e45c825d518">cl_regopt_anchor_end</a>, <a class="el" href="regopt_8c.html#a44d3ff55dc4223346a2c4f9c4f4cd30f">cl_regopt_anchor_start</a>, <a class="el" href="regopt_8c.html#a65b125ab93c3082f07ff0d7635350079">cl_regopt_grain_len</a>, <a class="el" href="regopt_8c.html#ac4527918221c359efeb1d01fb10a1a93">cl_regopt_grains</a>, <a class="el" href="regopt_8c.html#ae4d9d4be4e6b1ead777698efd2b39098">grain_buffer</a>, <a class="el" href="regopt_8c.html#a6572b918e13646e4ca08c5ce0e40ce8a">grain_buffer_grains</a>, <a class="el" href="regopt_8c.html#ae2ea7a07e65b954f5245d85ebc04cbbf">grain_buffer_len</a>, <a class="el" href="regopt_8c.html#a3be657173ddc2221aa23f1eac93286c2">local_grain_data</a>, <a class="el" href="regopt_8c.html#ae7f8befdb6db56e9d197e57131df7743">read_disjunction()</a>, <a class="el" href="regopt_8c.html#a6a67a8d9123368ccd2b44bf6a3fa0f1a">read_grain()</a>, <a class="el" href="regopt_8c.html#a87df1b305a39abd5ce65350a82a00668">read_kleene()</a>, <a class="el" href="regopt_8c.html#a237d16bb69251631763e7e7853c5a662">read_wildcard()</a>, and <a class="el" href="regopt_8c.html#af70f0febe7ba408c9ea0d7523f837212">update_grain_buffer()</a>.</p>

<p>Referenced by <a class="el" href="regopt_8c.html#a2c4607eb8e094b7699062df8eb744058">cl_new_regex()</a>.</p>

</div>
</div>
<a class="anchor" id="a697918b2f55aa6a0fd29906a934f5836"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void regopt_data_copy_to_regex_object </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cl_8h.html#ab595272450836292a293ea13eb49ef0b">CL_Regex</a>&#160;</td>
          <td class="paramname"><em>rx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copy grain set from internal global variables to CL_Regex object &ndash; part of the CL Regex Optimiser. </p>
<p>This function carries out four important tasks:</p><ul>
<li>It copies the grain set found by cl_regopt_analyse from the internal global buffer to member variables of the specified CL_Regex object.</li>
<li>It casefolds the grains if required (i.e. if rx-&gt;icase is True).</li>
<li>It cuts grains to equal byte length, preserving start/end anchoring if possible. Note that our implementation of Boyer-Moore search requires equally sized grains.</li>
<li>It calls make_jump_table to generate a lookup table for the Boyer-Moore search.</li>
</ul>
<p>This is a non-exported function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rx</td><td>a pointer to an initialized CL_Regex object </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="struct___c_l___regex.html#a93e5ad5e0410fdbd7c65a09793a14cb6">_CL_Regex::anchor_end</a>, <a class="el" href="struct___c_l___regex.html#a4e3ccc6f2ec66b18f80763c9101dc2a7">_CL_Regex::anchor_start</a>, <a class="el" href="struct___c_l___regex.html#ab7d33183c58d7df43cc5602b9c842b37">_CL_Regex::charset</a>, <a class="el" href="globals_8c.html#a5c4290325b240eac5fe1542a8743286a">cl_debug</a>, <a class="el" href="cl_8h.html#ad68dfe0ca2fbad5052e8213a06f5b4ba">CL_MAX_LINE_LENGTH</a>, <a class="el" href="regopt_8c.html#aeea8fcadfd245bf518d90e45c825d518">cl_regopt_anchor_end</a>, <a class="el" href="regopt_8c.html#a44d3ff55dc4223346a2c4f9c4f4cd30f">cl_regopt_anchor_start</a>, <a class="el" href="regopt_8c.html#a17c41125f23920984f3734380cab57c4">cl_regopt_grain</a>, <a class="el" href="regopt_8c.html#ac4527918221c359efeb1d01fb10a1a93">cl_regopt_grains</a>, <a class="el" href="cl_8h.html#a1afd81ceb72fcd8e9e8e91983a0528a8">cl_strdup()</a>, <a class="el" href="cl_8h.html#a708281d7f482a1999c70df6c353d66e1">cl_string_canonical()</a>, <a class="el" href="struct___c_l___regex.html#a343da7a5241d5dd4042b632f9c39006e">_CL_Regex::grain</a>, <a class="el" href="struct___c_l___regex.html#a6f097fa6018c5b24ea16507555185feb">_CL_Regex::grain_len</a>, <a class="el" href="struct___c_l___regex.html#a809c37615b266e2fdd396ac191b9a93c">_CL_Regex::grains</a>, <a class="el" href="struct___c_l___regex.html#a2a54e4cd12e90b8adc180c6ed49d3fe9">_CL_Regex::icase</a>, <a class="el" href="cl_8h.html#a1f397c74f7f8ba3952858c70eb19d082">IGNORE_CASE</a>, <a class="el" href="regopt_8c.html#a3be657173ddc2221aa23f1eac93286c2">local_grain_data</a>, and <a class="el" href="regopt_8c.html#aaad88d21f908e7e9eff392739d19ef94">make_jump_table()</a>.</p>

<p>Referenced by <a class="el" href="regopt_8c.html#a2c4607eb8e094b7699062df8eb744058">cl_new_regex()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 17 2017 20:15:18 for CWB by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
